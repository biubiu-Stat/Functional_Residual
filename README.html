<h1 id="reproducibility-materials">Reproducibility Materials</h1>
<p>Code to reproduce simulation results, figures and real data analysis
results from the paper “A unified framework for residual diagnostics in
generalized linear models and beyond”</p>
<h2 id="organization">Organization</h2>
<h1 id="r-functions-for-model-diagnostics">R Functions for Model
Diagnostics</h1>
<p>To provide code that actually implements the method, we have created
the following R functions.</p>
<ul>
<li><p><strong><code>fresiduals</code></strong> is a function for
producing functional residuals. More specifically, it yields <span
class="math inline">\(\pi(y-1;\mathbf{x})\)</span> and <span
class="math inline">\(\pi(y;\mathbf{x})\)</span> that are used to define
a functional residual in Equation (2) on page 6 of the manuscript. The
input is a fitted model, which can be a <code>vglm</code>,
<code>glm</code>, <code>tsglm</code>, or <code>zeroinfl</code> object.
This function generates an <span class="math inline">\(n \times
2\)</span> matrix as its output, where <span
class="math inline">\(n\)</span> rows correspond to the <span
class="math inline">\(n\)</span> observations, and 2 columns correspond
to <span class="math inline">\(\pi(y - 1; \mathbf{x})\)</span> and <span
class="math inline">\(\pi(y; \mathbf{x})\)</span> for each observation.
This output can be called by other functions to generate model
diagnostics results.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>bikedata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;hour.csv&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(cnt <span class="sc">~</span> ., <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">data =</span> bikedata)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>FR <span class="ot">&lt;-</span> <span class="fu">fresiduals</span>(model)</span></code></pre></div></li>
<li><p><strong><code>fresplot</code></strong> is a function for
generating functional-residual-vs-covariate plots, visualizing the
density of functional residuals as a heatmap. These plots can be
rendered on either uniform or normal scales. It requires three
inputs:</p>
<ul>
<li><strong><code>fresiduals</code></strong>: the object generated from
the R function <code>fresiduals</code>.</li>
<li><strong><code>x</code></strong>: the covariate against which to plot
functional residuals.</li>
<li><strong><code>scale</code></strong>: the scale of functional
residuals, which can be uniform or normal.</li>
</ul>
<p>The <code>fresplot</code> function provides optional inputs, such as
<code>title</code>, which enables users to customize the plot title. It
also offers <code>xl</code> and <code>xp</code> for setting the lower
and upper limits of the x-axis, and <code>yl</code> and <code>yp</code>
for setting the lower and upper limits of the y-axis.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fresplot</span>(<span class="at">fresiduals =</span> FR, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> hr, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Functional residual vs. hour&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">&quot;normal&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xl =</span> <span class="dv">0</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xp =</span> <span class="dv">24</span>)</span></code></pre></div></li>
<li><p><strong><code>ffplot</code></strong> is a function that generates
an <span class="math inline">\(F_n\)</span>- <span
class="math inline">\(F_n\)</span> plot. It requires a single input:</p>
<ul>
<li><strong><code>fresiduals</code></strong>: the object generated from
the <code>fresiduals</code> function.</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ffplot</span>(<span class="at">fresiduals =</span> FR,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Fn-Fn Plot&quot;</span>)</span></code></pre></div></li>
<li><p><strong><code>ffplot.envelop</code></strong> generates an <span
class="math inline">\(F_n\)</span>- <span
class="math inline">\(F_n\)</span> plot with a ``probable envelop”. The
envelope is formed by creating confidence bounds around the <span
class="math inline">\(F_n\)</span>- <span
class="math inline">\(F_n\)</span> curve. At any given point <span
class="math inline">\(t\)</span>, it reduces to a confidence interval
for <span class="math inline">\(\overline{Res}(t)\)</span> in (4) of the
manuscript (with a pre-specified error rate <span
class="math inline">\(\alpha\)</span>). Specifically, the envelop is the
set $ _{1-} = {(L^*_{/2}(t), U^*_{1-/2}(t)), t (0,1)}$, where <span
class="math inline">\(L^*_{\alpha/2}(t)\)</span> and <span
class="math inline">\(U^*_{1-\alpha/2}(t)\)</span> are lower and upper
bounds constructed using the bootstrap method (see Supplementary
Materials G to the paper). If the 45-degree line falls outside <span
class="math inline">\(\mathcal{E}_{1-\alpha}\)</span>, this may be
regarded as evidence against the null that the model is
correct.</p></li>
</ul>
<h3 id="simulation-code">Simulation-code</h3>
<h4 id="illustration-figures">Illustration Figures</h4>
<ul>
<li>“Sim_Illustration.R” contains R code for Figure 1-3 in Section
2.3</li>
</ul>
<h4 id="simulation-for-ordinal-data">Simulation for ordinal data</h4>
<ul>
<li><p>“Sim_Ordinal_Data.R” contains R code for</p>
<ul>
<li>Figure 4-5 in Section 3.1;</li>
<li>Figure S1-S4 in Supplementary Materials B;</li>
<li>Figure S21 and S22 in Supplementary Materials F.</li>
</ul></li>
</ul>
<h4 id="simulation-for-count-data">Simulation for count data</h4>
<ul>
<li>“Sim_Count_Data.R” contains R code for
<ul>
<li>Figure S5-S9 in Supplementary Materials B;</li>
<li>Figure S17-S19 in Supplementary Materials D.</li>
</ul></li>
</ul>
<h4 id="simulation-graphical-test">Simulation Graphical Test</h4>
<ul>
<li>“Sim_Graphical_test.R” contains R code for Figure S23 in
Supplementary Materials G;</li>
<li>“Sim_Power_Comparison.R” contains R code for producing the results
displayed in Table S4 in Supplementary Materials G.</li>
</ul>
<h3 id="simulation-results">Simulation-results</h3>
<p>Contains the results from running the code in the simulation-code
folder as described above.</p>
<h3 id="real-data">Real-data</h3>
<ul>
<li><p>“winequality-white.csv” contains the real data set in Section
5.1. Detailed information about this dataset can be accessed <a
href="https://archive.ics.uci.edu/dataset/186/wine+quality">here</a>.</p></li>
<li><p>“hour.csv” contains the real data set in Section 5.2. Detailed
information about this dataset can be accessed <a
href="https://archive.ics.uci.edu/dataset/275/bike+sharing+dataset">here</a>.</p></li>
</ul>
<h3 id="real-data-code">Real-data-code</h3>
<ul>
<li><p>“Whitewine.R” contains the code to run real data analysis in
Section 5.1. It produces</p>
<ul>
<li>Figure S10-S12 in Supplementary Materials B;</li>
<li>Table S1 in Supplementary Materials C.</li>
</ul></li>
<li><p>“Bike.R” contains the code to run real data analysis in Section
5.2. It produces</p>
<ul>
<li>Figure S13-S16 in Supplementary Materials B;</li>
<li>Table S3 in Supplementary Materials C.</li>
</ul></li>
<li><p>“Bike_TimeSeries.R” contains the code to run the temporal effects
analysis and produces Figure S20 in Supplementary Materials E.</p></li>
<li><p>“Robustness.R” contains the code to run the robustness analysis
and produces Figure S24 in Supplementary Materials E.</p></li>
</ul>
